<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KKBox Churn Prediction | Big Data Analytics</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Rajdhani:wght@300;500;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body>

    <div class="scanlines"></div>
    <div class="noise"></div>
    <div class="bg-grid"></div>

    <div class="layout-wrapper">
        
        <nav class="cyber-nav">
            <div class="nav-brand">
                <span class="material-icons spin-slow">hub</span> ANALYTICS
            </div>
            <ul class="nav-links">
                <li><a href="#phase1" class="active"><span class="nav-num">01</span> PROBLEM</a></li>
                <li><a href="#phase2"><span class="nav-num">02</span> DATA SOURCE</a></li>
                <li><a href="#phase3"><span class="nav-num">03</span> ARCHITECTURE</a></li>
                <li><a href="#phase4"><span class="nav-num">04</span> METHODOLOGY</a></li>
                <li><a href="#phase5"><span class="nav-num">05</span> EXECUTION</a></li>
            </ul>
            <div class="nav-status">
                <div class="status-item"><span class="dot green"></span> SYSTEM: ONLINE</div>
                <div class="status-item"><span class="dot yellow"></span> CPU: 34%</div>
            </div>
        </nav>

        <main class="main-content">

            <header class="hero-section">
                <div class="hero-content">
                    <div class="glitch-wrapper">
                        <h1 class="glitch" data-text="KKBOX CHURN PREDICTION">KKBOX CHURN PREDICTION</h1>
                    </div>
                    <p class="mission-brief">
                        <span class="bracket">[</span> MISSION OBJECTIVE <span class="bracket">]</span>
                        Predict membership expiration within 30 days using Big Data ETL and Temporal Behavioral Analysis.
                    </p>
                    
                    <div class="stats-bar-container">
                        <div class="stat-item">
                            <span class="stat-label">USER VOLUME</span>
                            <div class="progress-bar"><div class="fill" style="width: 80%;"></div></div>
                            <span class="stat-value">6.7M USERS</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">LOGS (30GB)</span>
                            <div class="progress-bar"><div class="fill neon-pink" style="width: 95%;"></div></div>
                            <span class="stat-value">400M ROWS</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">TRANSACTIONS</span>
                            <div class="progress-bar"><div class="fill neon-purple" style="width: 60%;"></div></div>
                            <span class="stat-value">21M TXNS</span>
                        </div>
                    </div>
                </div>
            </header>

            <section id="phase1" class="panel-section">
                <div class="panel-header">
                    <span class="panel-icon material-icons">radar</span>
                    <h2>PHASE 1: PROBLEM IDENTIFICATION</h2>
                </div>
                <div class="tech-border">
                    <div class="content-grid">
                        <div class="text-block">
                            <h3><span class="highlight">>></span> USE CASE DEFINITION</h3>
                            <p>The goal is to build a <strong>binary classification model</strong>. We must predict if a subscriber will churn (fail to renew) shortly after their plan expires. Unlike standard datasets, this involves analyzing <strong>temporal transaction history</strong> and heavy user logs.</p>
                        </div>
                        <div class="kpi-grid">
                            <div class="kpi-card">
                                <span class="material-icons">timer</span>
                                <h4>30 DAYS</h4>
                                <small>Prediction Window</small>
                            </div>
                            <div class="kpi-card">
                                <span class="material-icons">key</span>
                                <h4>MSNO</h4>
                                <small>Unique Primary Key</small>
                            </div>
                            <div class="kpi-card alert">
                                <span class="material-icons">warning</span>
                                <h4>IMBALANCED</h4>
                                <small>~5-10% Churn Rate</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="phase2" class="panel-section">
                <div class="panel-header">
                    <span class="panel-icon material-icons">dns</span>
                    <h2>PHASE 2: DATA SOURCING</h2>
                </div>
                <div class="tech-border">
                    <p class="section-intro">This is a <strong>Relational Dataset</strong> consisting of four distinct tables linked by `msno`. The scale (30GB) requires a Big Data architecture.</p>
                    
                    <div class="schema-visual">
                        <div class="table-node members">
                            <div class="table-head"><span class="material-icons">person</span> MEMBERS</div>
                            <div class="table-body">
                                <span>PK: msno</span>
                                <span>city, bd, gender</span>
                                <span>registration_init_time</span>
                            </div>
                        </div>

                        <div class="link-line"></div>

                        <div class="table-node transactions">
                            <div class="table-head"><span class="material-icons">receipt</span> TRANSACTIONS</div>
                            <div class="table-body">
                                <span>FK: msno</span>
                                <span>payment_method</span>
                                <span>plan_days, price</span>
                                <span>is_auto_renew</span>
                            </div>
                        </div>

                        <div class="link-line"></div>

                        <div class="table-node logs warning-border">
                            <div class="table-head"><span class="material-icons">headphones</span> USER_LOGS (Big Data)</div>
                            <div class="table-body">
                                <span>FK: msno</span>
                                <span>date</span>
                                <span>num_25, num_50...</span>
                                <span>total_secs</span>
                            </div>
                        </div>
                    </div>
                    <div class="data-note">
                        <span class="material-icons">info</span> 
                        <strong>Optimization Strategy:</strong> CSV is row-based and slow. We convert raw data to <strong>Parquet</strong> (columnar) immediately, increasing read speed by 10-50x.
                    </div>
                </div>
            </section>

            <section id="phase3" class="panel-section">
                <div class="panel-header">
                    <span class="material-icons">schema</span>
                    <h2>PHASE 3: PIPELINE ARCHITECTURE</h2>
                </div>
                <div class="tech-border">
                    <div class="pipeline-flow">
                        <div class="flow-step">
                            <div class="step-icon"><span class="material-icons">file_upload</span></div>
                            <h4>INGESTION</h4>
                            <p>Raw CSV to Spark DataFrame</p>
                        </div>
                        <div class="flow-arrow"><span class="material-icons">double_arrow</span></div>
                        
                        <div class="flow-step">
                            <div class="step-icon"><span class="material-icons">storage</span></div>
                            <h4>DATA LAKE</h4>
                            <p>Parquet Storage (S3/HDFS)</p>
                        </div>
                        <div class="flow-arrow"><span class="material-icons">double_arrow</span></div>

                        <div class="flow-step active-glow">
                            <div class="step-icon"><span class="material-icons">memory</span></div>
                            <h4>SPARK ETL</h4>
                            <p>Aggregating 400M Logs</p>
                            <small class="tech-tag">PySpark</small>
                        </div>
                        <div class="flow-arrow"><span class="material-icons">double_arrow</span></div>

                        <div class="flow-step">
                            <div class="step-icon"><span class="material-icons">table_view</span></div>
                            <h4>GOLD TABLE</h4>
                            <p>User-Level Features (1GB)</p>
                        </div>
                        <div class="flow-arrow"><span class="material-icons">double_arrow</span></div>

                        <div class="flow-step">
                            <div class="step-icon"><span class="material-icons">model_training</span></div>
                            <h4>MODELING</h4>
                            <p>LightGBM Training</p>
                            <small class="tech-tag">Python</small>
                        </div>
                    </div>
                </div>
            </section>

            <section id="phase4" class="panel-section">
                <div class="panel-header">
                    <span class="material-icons">psychology</span>
                    <h2>PHASE 4: ML METHODOLOGY</h2>
                </div>
                
                <div class="method-grid">
                    <div class="method-card">
                        <h3>01. PRE-PROCESSING</h3>
                        <ul class="detail-list">
                            <li>
                                <strong><span class="material-icons">transgender</span> Gender Handling:</strong>
                                <p>Contains many nulls. Strategy: Create category "Unknown". Missing data is a predictive signal itself.</p>
                            </li>
                            <li>
                                <strong><span class="material-icons">cake</span> Age (bd) Cleaning:</strong>
                                <p>Outliers present (-5, 200). Strategy: Filter range 10-80. Impute invalid values with <strong>Median</strong> (robust to outliers).</p>
                            </li>
                            <li>
                                <strong><span class="material-icons">label</span> Encoding:</strong>
                                <p>Label Encoding used for City/Registered_via. One-Hot avoided to prevent sparsity.</p>
                            </li>
                        </ul>
                    </div>

                    <div class="method-card highlight-card">
                        <h3>02. FEATURE ENGINEERING (RFM)</h3>
                        <p class="subtitle">Turning raw logs into behavioral insights.</p>
                        <ul class="detail-list">
                            <li>
                                <strong>Engagement Quality:</strong>
                                <br><code>%_completed = num_100 / total_songs</code>
                                <br><code>%_skipped = num_25 / total_songs</code>
                            </li>
                            <li>
                                <strong>Financial Behavior:</strong>
                                <br><code>auto_renew_change</code>: Did they toggle auto-renew off? (Strongest Predictor)
                            </li>
                            <li>
                                <strong>Recency:</strong> Days since last user_log entry.
                            </li>
                        </ul>
                    </div>

                    <div class="method-card">
                        <h3>03. ALGORITHM: LightGBM</h3>
                        <div class="algo-stats">
                            <span class="badge">Gradient Boosting</span>
                            <span class="badge">Tree-Based</span>
                        </div>
                        <ul class="detail-list">
                            <li><strong>Why not XGBoost?</strong> LightGBM is significantly faster on large datasets.</li>
                            <li><strong>Null Handling:</strong> Handles missing values natively.</li>
                            <li><strong>Imbalance:</strong> Uses <code>scale_pos_weight</code> to penalize false negatives.</li>
                            <li><strong>Scaling:</strong> No normalization (Z-Score) needed for tree-based splits.</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="phase5" class="panel-section">
                <div class="panel-header">
                    <span class="material-icons">code</span>
                    <h2>PHASE 5: IMPLEMENTATION LOGS</h2>
                </div>

                <div class="code-terminal">
                    <div class="terminal-header">
                        <span class="dot red"></span><span class="dot yellow"></span><span class="dot green"></span>
                        <span class="filename">pipeline_execution.py</span>
                    </div>
                    <div class="terminal-body">
<pre><code><span class="line">01</span> <span class="comment"># --- STEP 1: SPARK AGGREGATION (Big Data Layer) ---</span>
<span class="line">02</span> <span class="keyword">def</span> <span class="func">process_logs_spark</span>():
<span class="line">03</span>     logs = spark.read.csv(<span class="str">"user_logs.csv"</span>)
<span class="line">04</span>     
<span class="line">05</span>     <span class="comment"># Group by UserID to reduce 400M rows -> 6.7M rows</span>
<span class="line">06</span>     user_features = logs.groupBy(<span class="str">"msno"</span>).agg(
<span class="line">07</span>         avg(<span class="str">"total_secs"</span>).alias(<span class="str">"avg_listen_time"</span>),
<span class="line">08</span>         sum(<span class="str">"num_unq"</span>).alias(<span class="str">"total_unique_songs"</span>),
<span class="line">09</span>         max(<span class="str">"date"</span>).alias(<span class="str">"last_seen_date"</span>)
<span class="line">10</span>     )
<span class="line">11</span>     <span class="keyword">return</span> user_features
<span class="line">12</span> 
<span class="line">13</span> <span class="comment"># --- STEP 2: MODEL TRAINING (LightGBM) ---</span>
<span class="line">14</span> <span class="keyword">def</span> <span class="func">train_model</span>(df):
<span class="line">15</span>     X = df.drop([<span class="str">"is_churn"</span>, <span class="str">"msno"</span>], axis=1)
<span class="line">16</span>     y = df[<span class="str">"is_churn"</span>]
<span class="line">17</span> 
<span class="line">18</span>     <span class="comment"># Handling Imbalance (Ratio 1:9) using scale_pos_weight</span>
<span class="line">19</span>     model = lgb.LGBMClassifier(
<span class="line">20</span>         n_estimators=<span class="num">1000</span>,
<span class="line">21</span>         learning_rate=<span class="num">0.05</span>,
<span class="line">22</span>         scale_pos_weight=<span class="num">9</span>
<span class="line">23</span>     )
<span class="line">24</span>     model.fit(X_train, y_train)
<span class="line">25</span>     <span class="keyword">return</span> model</code></pre>
                    </div>
                </div>

                <div class="metrics-panel">
                    <div class="metric-box">
                        <div class="metric-icon"><span class="material-icons">assessment</span></div>
                        <div class="metric-info">
                            <h5>PRIMARY METRIC</h5>
                            <span class="metric-val text-red">LOG LOSS</span>
                            <p>Penalizes confidence in wrong answers. Essential for probability calibration.</p>
                        </div>
                    </div>
                    <div class="metric-box">
                        <div class="metric-icon"><span class="material-icons">trending_up</span></div>
                        <div class="metric-info">
                            <h5>BUSINESS METRIC</h5>
                            <span class="metric-val text-green">RECALL</span>
                            <p>Minimizes False Negatives. Ensures we catch churners to send retention offers.</p>
                        </div>
                    </div>
                </div>
            </section>

        </main>
    </div>

</body>
</html>